{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/ferreteria-bot/web/app/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useMemo, useState } from 'react'\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n)\n\ntype Row = {\n  id: string\n  title: string | null\n  rm_price: number | null\n  valpo_price: number | null\n  ohiggins_price: number | null\n  ok: boolean | null\n  error: string | null\n  fetched_at: string | null\n}\n\nfunction parseBulk(text: string): string[] {\n  return text\n    .split(/\\r?\\n|,|;|\\s+/)\n    .map((s) => s.trim())\n    .filter(Boolean)\n}\n\nexport default function Home() {\n  const [rows, setRows] = useState<Row[]>([])\n  const [q, setQ] = useState('')\n  const [oneId, setOneId] = useState('')\n  const [bulk, setBulk] = useState('')\n  const [msg, setMsg] = useState<string | null>(null)\n\n  async function load() {\n    setMsg(null)\n\n    const { data: tracked, error: e1 } = await supabase\n      .from('tracked_products')\n      .select('id')\n      .order('created_at', { ascending: false })\n\n    if (e1) {\n      setMsg('Error cargando IDs: ' + e1.message)\n      return\n    }\n\n    const ids = (tracked ?? []).map((t) => t.id)\n    if (!ids.length) {\n      setRows([])\n      return\n    }\n\n    const out: Row[] = []\n    for (const id of ids) {\n      const { data: snap, error: e2 } = await supabase\n        .from('product_snapshots')\n        .select('title,rm_price,valpo_price,ohiggins_price,ok,error,fetched_at')\n        .eq('product_id', id)\n        .order('fetched_at', { ascending: false })\n        .limit(1)\n\n      if (e2) {\n        out.push({\n          id,\n          title: null,\n          rm_price: null,\n          valpo_price: null,\n          ohiggins_price: null,\n          ok: false,\n          error: e2.message,\n          fetched_at: null,\n        })\n      } else {\n        const s = snap?.[0]\n        out.push({\n          id,\n          title: s?.title ?? null,\n          rm_price: s?.rm_price ?? null,\n          valpo_price: s?.valpo_price ?? null,\n          ohiggins_price: s?.ohiggins_price ?? null,\n          ok: s?.ok ?? null,\n          error: s?.error ?? null,\n          fetched_at: s?.fetched_at ?? null,\n        })\n      }\n    }\n\n    setRows(out)\n  }\n\n  useEffect(() => {\n    load()\n  }, [])\n\n  const filtered = useMemo(() => {\n    const qq = q.trim().toLowerCase()\n    if (!qq) return rows\n    return rows.filter(\n      (r) => r.id.includes(qq) || (r.title ?? '').toLowerCase().includes(qq)\n    )\n  }, [rows, q])\n\n  async function addOne() {\n    const id = oneId.trim()\n    if (!id) return\n\n    const { error } = await supabase\n      .from('tracked_products')\n      .upsert({ id }, { onConflict: 'id' })\n\n    if (error) setMsg('Error agregando: ' + error.message)\n    else {\n      setMsg('Agregado: ' + id)\n      setOneId('')\n      await load()\n    }\n  }\n\n  async function addBulk() {\n    const ids = parseBulk(bulk)\n    if (!ids.length) return\n\n    const payload = ids.map((id) => ({ id }))\n    const { error } = await supabase\n      .from('tracked_products')\n      .upsert(payload, { onConflict: 'id' })\n\n    if (error) setMsg('Error bulk: ' + error.message)\n    else {\n      setMsg(`Agregados ${ids.length} IDs`)\n      setBulk('')\n      await load()\n    }\n  }\n\n  async function removeId(id: string) {\n    const { error } = await supabase.from('tracked_products').delete().eq('id', id)\n    if (error) setMsg('Error borrando: ' + error.message)\n    else {\n      setMsg('Borrado: ' + id)\n      await load()\n    }\n  }\n\n  return (\n    <main className=\"min-h-screen p-6 max-w-6xl mx-auto\">\n      <h1 className=\"text-2xl font-semibold\">Ferretería CM — Monitor de precios</h1>\n      <p className=\"text-sm opacity-70 mt-1\">\n        Regiones: RM / Valparaíso / O’Higgins — actualización diaria (worker).\n      </p>\n\n      {msg && <div className=\"mt-4 p-3 rounded border text-sm\">{msg}</div>}\n\n      <div className=\"grid md:grid-cols-2 gap-4 mt-6\">\n        <div className=\"p-4 rounded border\">\n          <h2 className=\"font-medium\">Agregar 1 producto</h2>\n          <div className=\"flex gap-2 mt-3\">\n            <input\n              className=\"border rounded px-3 py-2 w-full\"\n              placeholder=\"ID (ej: 2085728)\"\n              value={oneId}\n              onChange={(e) => setOneId(e.target.value)}\n            />\n            <button className=\"border rounded px-3 py-2\" onClick={addOne}>\n              Agregar\n            </button>\n          </div>\n        </div>\n\n        <div className=\"p-4 rounded border\">\n          <h2 className=\"font-medium\">Agregar masivo</h2>\n          <textarea\n            className=\"border rounded px-3 py-2 w-full mt-3 h-28\"\n            placeholder=\"Pega IDs separados por espacios, comas o saltos de línea\"\n            value={bulk}\n            onChange={(e) => setBulk(e.target.value)}\n          />\n          <div className=\"flex justify-end mt-2\">\n            <button className=\"border rounded px-3 py-2\" onClick={addBulk}>\n              Agregar lista\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"mt-8 flex items-center gap-3\">\n        <input\n          className=\"border rounded px-3 py-2 w-full\"\n          placeholder=\"Buscar por ID o nombre…\"\n          value={q}\n          onChange={(e) => setQ(e.target.value)}\n        />\n        <button className=\"border rounded px-3 py-2\" onClick={load}>\n          Refrescar\n        </button>\n      </div>\n\n      <div className=\"mt-4 overflow-auto border rounded\">\n        <table className=\"min-w-[900px] w-full text-sm\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"text-left p-3\">ID</th>\n              <th className=\"text-left p-3\">Nombre</th>\n              <th className=\"text-left p-3\">RM</th>\n              <th className=\"text-left p-3\">Valpo</th>\n              <th className=\"text-left p-3\">O’Higgins</th>\n              <th className=\"text-left p-3\">Estado</th>\n              <th className=\"text-left p-3\">Actualizado</th>\n              <th className=\"text-right p-3\">Acción</th>\n            </tr>\n          </thead>\n          <tbody>\n            {filtered.map((r) => (\n              <tr key={r.id} className=\"border-t\">\n                <td className=\"p-3 font-mono\">{r.id}</td>\n                <td className=\"p-3\">{r.title ?? '—'}</td>\n                <td className=\"p-3\">{r.rm_price ?? '—'}</td>\n                <td className=\"p-3\">{r.valpo_price ?? '—'}</td>\n                <td className=\"p-3\">{r.ohiggins_price ?? '—'}</td>\n                <td className=\"p-3\">\n                  {r.ok ? '✅ OK' : '⚠️ FAIL'}\n                  {r.error ? <div className=\"text-xs opacity-60\">{r.error}</div> : null}\n                </td>\n                <td className=\"p-3\">\n                  {r.fetched_at ? new Date(r.fetched_at).toLocaleString() : '—'}\n                </td>\n                <td className=\"p-3 text-right\">\n                  <button className=\"border rounded px-2 py-1\" onClick={() => removeId(r.id)}>\n                    Quitar\n                  </button>\n                </td>\n              </tr>\n            ))}\n            {!filtered.length && (\n              <tr>\n                <td className=\"p-4 opacity-60\" colSpan={8}>\n                  No hay productos aún. Agrega un ID arriba.\n                </td>\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n    </main>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}